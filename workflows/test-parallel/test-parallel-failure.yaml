version: 1
metadata:
  name: Parallel Failure Test
  description: Test that continueOnFailure false stops the workflow after the current batch completes.

nodes:
  - id: trigger
    type: trigger
    position:
      x: 50
      "y": 150
    data:
      nodeType: trigger
      label: Start
      triggerType: manual
      outputs:
        - name: timestamp
          type: string
        - name: type
          type: string
        - name: text
          type: string
        - name: params
          type: json

  - id: success-node
    type: shell
    position:
      x: 300
      "y": 50
    data:
      nodeType: shell
      label: Success Node
      script: |
        echo "Success node starting"
        sleep 1
        echo "Success node completed"
      inputs:
        - name: input
          type: string
          required: false
      outputs:
        - name: output
          type: string
        - name: stdout
          type: string
        - name: stderr
          type: string
        - name: exitCode
          type: number

  - id: fail-node
    type: shell
    position:
      x: 300
      "y": 150
    data:
      nodeType: shell
      label: Fail Node
      continueOnFailure: false
      script: |
        echo "Fail node starting"
        sleep 0.5
        exit 1
      inputs:
        - name: input
          type: string
          required: false
      outputs:
        - name: output
          type: string
        - name: stdout
          type: string
        - name: stderr
          type: string
        - name: exitCode
          type: number

  - id: another-node
    type: shell
    position:
      x: 300
      "y": 250
    data:
      nodeType: shell
      label: Another Node
      script: |
        echo "Another node starting"
        sleep 1
        echo "Another node completed"
      inputs:
        - name: input
          type: string
          required: false
      outputs:
        - name: output
          type: string
        - name: stdout
          type: string
        - name: stderr
          type: string
        - name: exitCode
          type: number

  - id: downstream-of-fail
    type: shell
    position:
      x: 550
      "y": 150
    data:
      nodeType: shell
      label: Downstream of Fail
      script: |
        echo "This should NOT execute"
      inputs:
        - name: input
          type: string
          required: false
      outputs:
        - name: output
          type: string
        - name: stdout
          type: string
        - name: stderr
          type: string
        - name: exitCode
          type: number

edges:
  - id: e1
    source: trigger
    target: success-node
    sourceHandle: output:timestamp
    targetHandle: input:input
  - id: e2
    source: trigger
    target: fail-node
    sourceHandle: output:timestamp
    targetHandle: input:input
  - id: e3
    source: trigger
    target: another-node
    sourceHandle: output:timestamp
    targetHandle: input:input
  - id: e4
    source: fail-node
    target: downstream-of-fail
    sourceHandle: output:stdout
    targetHandle: input:input
