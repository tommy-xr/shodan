version: 2
metadata:
  name: Multi-line Script Demo
  description: Demonstrates multi-line shell scripts with loops, variables, and conditionals

nodes:
  - id: trigger_1
    type: trigger
    position: { x: 100, y: 150 }
    data:
      label: Start
      nodeType: trigger
      triggerType: manual
      outputs:
        - name: timestamp
          type: string
        - name: type
          type: string
        - name: text
          type: string
        - name: params
          type: json

  - id: shell_loop
    type: shell
    position: { x: 300, y: 50 }
    data:
      label: For Loop
      nodeType: shell
      script: |
        total=0
        for i in 1 2 3 4 5; do
          total=$((total + i))
        done
        echo "Sum: $total"

  - id: shell_conditional
    type: shell
    position: { x: 300, y: 150 }
    data:
      label: Conditional
      nodeType: shell
      script: |
        count=$(ls -1 *.yaml 2>/dev/null | wc -l | tr -d ' ')
        if [ "$count" -gt 0 ]; then
          echo "Found $count YAML files"
        else
          echo "No YAML files found"
        fi

  - id: shell_heredoc
    type: shell
    position: { x: 300, y: 250 }
    data:
      label: Here-doc
      nodeType: shell
      script: |
        cat <<EOF
        === Report ===
        Date: $(date +%Y-%m-%d)
        User: $(whoami)
        === End ===
        EOF

  - id: shell_summary
    type: shell
    position: { x: 550, y: 150 }
    data:
      label: Summary
      nodeType: shell
      inputs:
        - name: loop
          type: string
        - name: conditional
          type: string
        - name: heredoc
          type: string
      script: |
        echo "Multi-line scripts completed successfully"
        echo "Loop result: {{ inputs.loop }}"
        echo "Conditional result: {{ inputs.conditional }}"

edges:
  - id: e1
    source: trigger_1
    target: shell_loop
    sourceHandle: output:text
    targetHandle: input:input
  - id: e2
    source: trigger_1
    target: shell_conditional
    sourceHandle: output:text
    targetHandle: input:input
  - id: e3
    source: trigger_1
    target: shell_heredoc
    sourceHandle: output:text
    targetHandle: input:input
  - id: e4
    source: shell_loop
    target: shell_summary
    sourceHandle: output:stdout
    targetHandle: input:loop
  - id: e5
    source: shell_conditional
    target: shell_summary
    sourceHandle: output:stdout
    targetHandle: input:conditional
  - id: e6
    source: shell_heredoc
    target: shell_summary
    sourceHandle: output:stdout
    targetHandle: input:heredoc
